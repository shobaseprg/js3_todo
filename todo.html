<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <title>ToDo問題</title>
  </head>
  <body>
    <h1>ToDo問題</h1>
    <input type="radio" name="q1" value="すべて">全て
    <input type="radio" name="q1" value="作業中">作業中
    <input type="radio" name="q1" value="いいえ">完了
    <table id = "targetTable">
      <tr>
        <th>ID</th>
        <th>コメント</th>
        <th>状態</th>
      </tr>
    </table>
<h2>新規タスクの追加</h2>
<div>
  <input type="text" id="form" size="21">
  <input type="button" id ="addition" value="追加">
</div>
  <script>
    let array = []  // 空配列を宣言
    let table = document.getElementById("targetTable");  // テーブルを変数化
// ===================================
// 追加した場合
// ===================================
    document.getElementById("addition").addEventListener("click", () => { // 追加を押した場合
      if (document.getElementById("form").value) {  // フォームが空欄でなかった場合
        while (table.firstChild) {  // 一旦テーブルを空にする。
          table.removeChild(table.firstChild);
        }
        let comment = document.createTextNode(document.getElementById("form").value); // フォームの中身を取得
        array.push(comment);  // フォームの中身を配列に追加
        for (let i = 0; i < array.length; i++) {  // 配列を回す
          let newRow = table.insertRow();   // 空行を作成
          newRow.dataset.index = i ; // 配列のインデックスからカスタムデータ属性作成
          let idCell = newRow.insertCell();   // id空セルを作成
          let id = document.createTextNode(i);  // 配列のインデックスを取得
          idCell.appendChild(id); // インデックスを表示 

          let commentCell = newRow.insertCell(); // コメント空セルを作成
          commentCell.appendChild(array[i]);  // コメントを挿入

          let btnCell = newRow.insertCell();  // ボタン用の空行を作成
          let statusBtn = document.createElement("input");  // 状態ボタン作成
          statusBtn.type = "button";
          statusBtn.classList.add("statusbtn"); 
          statusBtn.dataset.index = i ; // 配列のインデックスからカスタムデータ属性作成
          statusBtn.value = "作業中";
          btnCell.appendChild(statusBtn);

          let deleteBtn = document.createElement("input");  // 状態ボタン作成
          deleteBtn.type = "button";
          deleteBtn.classList.add("deleteBtn");
          deleteBtn.dataset.index = i ;  // 配列のインデックスからカスタムデータ属性作成
          deleteBtn.value = "削除"
          btnCell.appendChild(deleteBtn);

          document.getElementById("form").value = "";  // フォームを空にする
        }
      } else { // フォームが空の場合
        alert('フォームに入力してください');
      }
    });
// ===================================
// 削除した場合
// ===================================

    document.addEventListener("click",(e) => {  // 削除ボタンがクリック
      if (e.target.className ==="deleteBtn") {  // 削除ボタンが存在する時（読み込みエラー回避）
        let targetIndex = e.target.dataset.index;  // 削除ボタンのカスタムデータ属性取得
        array.splice(parseFloat(targetIndex), 1); //配列から削除
      } 
    });
    </script>
  </body>
</html>
